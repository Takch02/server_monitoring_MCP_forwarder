version: "3.9"

services:
  target:
    image: user-target:latest
    container_name: user-target
    ports:
      - "8085:8085"
    volumes:
      - logs:/app/logs
    restart: unless-stopped

  forwarder:
    image: ${FORWARDER_IMAGE}
    container_name: mcp-forwarder
    depends_on: [target]
    volumes:
      - logs:/logs:ro
    environment:
      MCP_INGEST_URL: "https://${MCP_DOMAIN}/api/servers/${SERVER_NAME}/ingest/logs"
      MCP_TOKEN: "${INGEST_TOKEN}"
      LOG_PATH: "/logs/application.log"
      START_AT_END: "true"
      BATCH_MAX_LINES: "100"
      FLUSH_INTERVAL_MS: "1000"
      MAX_LINE_BYTES: "4096"
      HTTP_TIMEOUT_MS: "5000"
      BACKOFF_INITIAL_MS: "500"
      BACKOFF_MAX_MS: "10000"
    restart: unless-stopped

volumes:
  logs:
